// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model TrainingSession {
  id          String   @id @default(uuid())
  name        String
  description String?
  vma         Float
  pdfUrl      String?  // URL Minio (optionnel, génération à la demande)
  pdfKey      String?  // Clé S3 pour récupérer le fichier (optionnel)
  totalDistance Float  // en mètres
  totalTime     Int    // en secondes
  steps         Json   // Stocker les étapes en JSON
  sessionDate DateTime? // Date prévue de la séance (optionnel)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  userId      String?  // Pour plus tard si authentification
  createdBy   String?  // ID de l'utilisateur qui a créé la session (Clerk ID)

  @@index([createdAt])
  @@index([sessionDate])
  @@map("training_sessions")
}

model Event {
  id          String   @id @default(uuid())
  title       String
  description String?
  eventDate   DateTime
  startTime   String?  // Format "HH:mm" (ex: "14:30")
  type        String   @default("race") // 'race' | 'gathering' | 'other' | 'training_group'
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?  // ID de l'utilisateur qui a créé l'événement (Clerk ID)

  @@index([eventDate])
  @@map("events")
}

model GarminConnection {
  id           String   @id @default(uuid())
  userId       String   @unique // Clerk User ID
  tokens       String   @db.Text // Encrypted serialized tokens (dumps())
  displayName  String?  // Nom d'affichage Garmin
  garminGuid   String?  // GUID Garmin
  connectedAt  DateTime @default(now())
  lastSyncedAt DateTime @updatedAt

  @@index([userId])
  @@map("garmin_connections")
}
